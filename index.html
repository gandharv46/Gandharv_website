<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Gandharv Portfolio</title>

  <style>
    :root{
      --accent:#60AAD8;
      --bg:#05070a;
      --glass:rgba(255,255,255,0.08);
      --border:rgba(255,255,255,0.12);
      --muted:rgba(255,255,255,0.68);
      --shadow:0 24px 80px rgba(0,0,0,0.65);
      --radius:22px;
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(96,170,216,0.20), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(255,255,255,0.08), transparent 60%),
        var(--bg);
      color:#fff;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      overflow-x:hidden;
    }

    /* subtle premium grain */
    .grain{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.08;
      mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      transform:scale(1.2);
      z-index:0;
    }

    /* top bar */
    .topbar{
      position:sticky; top:0; z-index:20;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px;
      backdrop-filter:blur(14px);
      -webkit-backdrop-filter:blur(14px);
      background:linear-gradient(to bottom, rgba(0,0,0,.72), rgba(0,0,0,.15));
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width:0;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background:var(--accent);
      box-shadow:0 0 18px rgba(96,170,216,.65);
      flex:0 0 auto;
    }
    .title{
      font-weight:700; letter-spacing:.2px; font-size:14px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width:56vw;
    }
    .sub{
      font-size:12px; color:var(--muted);
      margin-top:2px;
    }

    .actions{
      display:flex; gap:10px; align-items:center;
      flex:0 0 auto;
    }

    .btn{
      border:1px solid var(--border);
      background:linear-gradient(180deg, var(--glass), rgba(255,255,255,0.04));
      color:#fff;
      padding:10px 12px;
      border-radius:14px;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      text-decoration:none;
      transition:transform .12s ease, opacity .12s ease, border-color .12s ease;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      display:inline-flex; gap:8px; align-items:center;
    }
    .btn:hover{ transform:translateY(-1px); border-color:rgba(255,255,255,0.22); }
    .btn:active{ transform:translateY(0); opacity:.92; }
    .btn.secondary{ color:var(--muted); font-weight:700; }

    /* upload card */
    .hero{
      position:relative;
      z-index:5;
      width:min(980px, 92vw);
      margin:18px auto 18px;
      padding:18px;
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(0,0,0,0.35);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 260px at 18% 15%, rgba(96,170,216,0.18), transparent 62%),
        radial-gradient(700px 260px at 82% 0%, rgba(255,255,255,0.10), transparent 62%);
      pointer-events:none;
      opacity:.9;
    }
    .hero-inner{
      position:relative;
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      flex-wrap:wrap;
    }
    .hero h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .hero p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
      max-width:64ch;
    }
    input[type="file"]{
      display:none;
    }
    .file-pill{
      border:1px dashed rgba(255,255,255,0.20);
      background:rgba(255,255,255,0.04);
      padding:10px 12px;
      border-radius:14px;
      color:rgba(255,255,255,0.80);
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:min(52vw, 420px);
    }

    /* pages container */
    #pages{
      position:relative;
      z-index:5;
      width:min(980px, 92vw);
      margin:0 auto 80px;
    }

    /* Each PDF page becomes a "section" */
    .page{
      margin:18px 0;
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.32);
      box-shadow:0 18px 55px rgba(0,0,0,0.55);
      overflow:hidden;

      /* animation base state */
      opacity:0;
      transform:translateY(18px) scale(0.985);
      filter:blur(6px);
      transition:opacity 520ms cubic-bezier(.2,.9,.2,1),
                 transform 520ms cubic-bezier(.2,.9,.2,1),
                 filter 520ms cubic-bezier(.2,.9,.2,1);
      will-change:opacity, transform, filter;
    }
    .page.is-visible{
      opacity:1;
      transform:translateY(0) scale(1);
      filter:blur(0);
    }

    /* subtle "shine" that sweeps when page appears */
    .page::after{
      content:"";
      position:absolute;
      inset:-30% -60%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,0.10), transparent);
      transform:translateX(-120%);
      opacity:0;
      pointer-events:none;
    }
    .page.is-visible::after{
      animation:shine 900ms ease-out 1;
      opacity:1;
    }
    @keyframes shine{
      0%{ transform:translateX(-120%); opacity:0; }
      20%{ opacity:1; }
      100%{ transform:translateX(120%); opacity:0; }
    }

    .page-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      background:linear-gradient(to bottom, rgba(0,0,0,0.45), rgba(0,0,0,0.10));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .page-label{
      font-size:12px;
      color:rgba(255,255,255,0.72);
      font-weight:700;
      letter-spacing:.2px;
    }
    .page-meta{
      font-size:12px;
      color:rgba(255,255,255,0.55);
    }

    canvas{
      display:block;
      width:100%;
      height:auto;
      background:#0b0d10;
    }

    /* loading overlay */
    #loading{
      position:fixed;
      inset:0;
      z-index:50;
      display:none;
      place-items:center;
      background:rgba(0,0,0,0.6);
      backdrop-filter:blur(14px);
      -webkit-backdrop-filter:blur(14px);
    }
    #loading.show{ display:grid; }
    .loading-card{
      width:min(520px, 90vw);
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      background:linear-gradient(180deg, rgba(255,255,255,0.09), rgba(255,255,255,0.04));
      box-shadow:0 24px 80px rgba(0,0,0,0.65);
      padding:16px 18px;
      position:relative;
      overflow:hidden;
    }
    .loading-card::after{
      content:"";
      position:absolute;
      inset:-20%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,0.14), transparent);
      animation:shine 1.2s ease-in-out infinite;
      transform:translateX(-120%);
    }
    .loading-title{
      position:relative;
      font-size:13px;
      font-weight:800;
      letter-spacing:.2px;
      margin-bottom:6px;
    }
    .loading-sub{
      position:relative;
      font-size:12px;
      color:rgba(255,255,255,0.70);
      line-height:1.45;
    }

    /* optional: "snap" feel (like website sections) */
    .snap #pages{
      scroll-snap-type:y proximity;
    }
    .snap .page{
      scroll-snap-align:start;
    }

    @media (max-width: 768px){
      .hero{ margin:12px auto; padding:14px; }
      .page{ margin:14px 0; border-radius:18px; }
      .btn{ padding:9px 10px; border-radius:12px; }
      .file-pill{ max-width:72vw; }
    }
  </style>
</head>

<body>
  <div class="grain"></div>

  <div class="topbar">
    <div class="brand">
      <span class="dot"></span>
      <div style="min-width:0;">
        <div class="title" id="docTitle">Gandharv Portfolio</div>
        <div class="sub" id="docMeta">Upload a PDF — it becomes a scrolling website.</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn secondary" id="toggleSnap" type="button">Scroll Snap: Off</button>
      <label class="btn" for="pdfInput">Upload PDF</label>
      <input id="pdfInput" type="file" accept="application/pdf" />
    </div>
  </div>

  <div class="hero">
    <div class="hero-inner">
      <div>
        <h1>Portfolio PDF → Website Experience</h1>
        <p>
          Upload a PDF and we render each page as a premium web section with smooth scroll animations.
          Perfect for a portfolio deck that feels like a site, not a file.
        </p>
      </div>
      <div class="file-pill" id="fileName">No file selected</div>
    </div>
  </div>

  <div id="pages"></div>

  <div id="loading">
    <div class="loading-card">
      <div class="loading-title">✨ Building the website…</div>
      <div class="loading-sub">Rendering pages and optimizing for smooth scrolling.</div>
    </div>
  </div>

  <!-- PDF.js (no build step) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.min.js"></script>

  <script>
    // --------- Config ----------
    const MAX_SCALE_DESKTOP = 1.8; // quality
    const MAX_SCALE_MOBILE  = 1.35;
    const VISIBILITY_THRESHOLD = 0.35;

    // PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.js";

    const pdfInput = document.getElementById("pdfInput");
    const pagesEl  = document.getElementById("pages");
    const fileName = document.getElementById("fileName");
    const docTitle = document.getElementById("docTitle");
    const docMeta  = document.getElementById("docMeta");
    const loading  = document.getElementById("loading");

    const toggleSnapBtn = document.getElementById("toggleSnap");
    let snapOn = false;

    toggleSnapBtn.addEventListener("click", () => {
      snapOn = !snapOn;
      document.body.classList.toggle("snap", snapOn);
      toggleSnapBtn.textContent = `Scroll Snap: ${snapOn ? "On" : "Off"}`;
    });

    function showLoading(show){
      loading.classList.toggle("show", !!show);
    }

    function clearPages(){
      pagesEl.innerHTML = "";
    }

    // IntersectionObserver for premium per-page reveal
    const io = new IntersectionObserver((entries) => {
      for (const e of entries){
        if (e.isIntersecting){
          e.target.classList.add("is-visible");
        }
      }
    }, { threshold: VISIBILITY_THRESHOLD });

    function isMobile(){
      return window.matchMedia("(max-width: 768px)").matches;
    }

    // Render a single page to canvas
    async function renderPage(pdf, pageNumber, scale){
      const page = await pdf.getPage(pageNumber);

      const viewport = page.getViewport({ scale });

      const pageWrap = document.createElement("section");
      pageWrap.className = "page";

      const header = document.createElement("div");
      header.className = "page-top";

      const left = document.createElement("div");
      left.className = "page-label";
      left.textContent = `Page ${pageNumber}`;

      const right = document.createElement("div");
      right.className = "page-meta";
      right.textContent = `${Math.round(viewport.width)}×${Math.round(viewport.height)}`;

      header.appendChild(left);
      header.appendChild(right);

      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d", { alpha: false });

      // Use devicePixelRatio for crispness, without killing performance
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      canvas.width  = Math.floor(viewport.width * dpr);
      canvas.height = Math.floor(viewport.height * dpr);
      canvas.style.width  = `${Math.floor(viewport.width)}px`;
      canvas.style.height = `${Math.floor(viewport.height)}px`;

      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      pageWrap.appendChild(header);
      pageWrap.appendChild(canvas);
      pagesEl.appendChild(pageWrap);

      // Observe for scroll reveal
      io.observe(pageWrap);

      // Render
      await page.render({ canvasContext: ctx, viewport }).promise;
    }

    // Render all pages
    async function renderPDF(arrayBuffer, name){
      showLoading(true);
      clearPages();

      fileName.textContent = name || "Uploaded PDF";
      docTitle.textContent = (name || "Gandharv Portfolio").replace(/\.pdf$/i, "");
      docMeta.textContent  = "Scroll — each PDF page is now a web section.";

      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

      // scale based on device (balance quality & speed)
      const scale = isMobile() ? MAX_SCALE_MOBILE : MAX_SCALE_DESKTOP;

      // Render sequentially to avoid jank spikes.
      // If you want faster: we can do small concurrency (2-3 pages at a time).
      for (let i = 1; i <= pdf.numPages; i++){
        await renderPage(pdf, i, scale);

        // small yield so UI stays responsive
        await new Promise(r => requestAnimationFrame(() => r()));
      }

      showLoading(false);

      // Scroll to first rendered page smoothly
      const first = pagesEl.querySelector(".page");
      if (first) first.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    pdfInput.addEventListener("change", async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;

      if (file.type !== "application/pdf"){
        alert("Please upload a PDF file.");
        return;
      }

      fileName.textContent = file.name;

      const buf = await file.arrayBuffer();
      await renderPDF(buf, file.name);
    });

    // Optional: allow drag-drop
    window.addEventListener("dragover", (e) => { e.preventDefault(); });
    window.addEventListener("drop", async (e) => {
      e.preventDefault();
      const file = e.dataTransfer?.files?.[0];
      if (!file) return;
      if (file.type !== "application/pdf"){
        alert("Please drop a PDF file.");
        return;
      }
      pdfInput.value = "";
      fileName.textContent = file.name;
      const buf = await file.arrayBuffer();
      await renderPDF(buf, file.name);
    });
  </script>
</body>
</html>
